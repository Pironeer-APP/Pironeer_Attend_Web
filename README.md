# Pironeer_Attend_Web

## 프로젝트 설명
이 프로젝트는 동아리 피로그래밍의 출석체크를 위한 것입니다. 주요 기능으로는 출석 확인, 출석 진행, 출석 관리 등이 있으며, Node.js를 사용하여 API를 제공합니다.

## 기술
- **사용된 기술 스택**: 
  - 백엔드: Node.js, Express
  - 데이터베이스: MongoDB
  - 인메모리 캐시: 출석을 위한 하나의 객체를 구현
- **아키텍처**:
  - **모델(Model)**: 데이터베이스와 상호작용하는 로직을 포함합니다.
  - **미들웨어(Middleware)**: 요청 처리 중간에 실행되는 로직으로, 인증, 로그, 데이터 검증 등을 담당합니다.
  - **컨트롤러(Controller)**: 요청을 처리하고 응답을 반환하는 로직을 포함합니다.
  - **라우터(Router)**: 요청 경로와 컨트롤러를 매핑합니다.
- **설계 패턴**: 각 부분을 모듈화하여 유지보수성과 확장성을 높였습니다.
- **성능 최적화**: 인메모리 캐시를 도입하여 데이터베이스 쿼리 횟수를 줄이고 응답 시간을 단축시켰습니다.

## 문제 해결
### 문제 1: 출석이 진행되는 10분간 서버 응답 시간 지연
- **원인 분석**: 데이터베이스에 대한 빈번한 쿼리로 인해 응답 시간이 길어짐.
  - HTTP 폴링으로 출석 진행 여부 확인
  - 기존 데이터베이스에 직접 조회시:
    - 실 사용자(30) * 초당 조회(300) * 데이터베이스 조회(2db read)
- **해결 방법**: 
  - 인메모리 캐시에 하나의 객체를 구현해 사용해 데이터베이스를 출석 생성시에 함번에 읽고 정보를 저장 후 이 객체를 통해 진행하다 10분 또는 종료 버튼을 누를 때 일괄로 넘겨주게 해 문제를 해결함
  - 정리하자면 인메모리 캐시를 사용하여 빈번하게 조회되는 데이터를 캐싱함으로써 데이터베이스 쿼리 횟수를 줄임.

### 문제 2: 출석이 진행되는 10분간 서버 부하
- **원인 분석**: 많은 API 요청으로 인해 서버의 부하가 증가함.
  - 모니터링 시 캐시 사용 효과 예상과 다르게 아직도 여부 확인 시 1db read 발생 확인
- **해결 방법**: 
  - 로그인 여부 확인 미들웨어가 등록되어 있었음 
  - 미들웨어를 삭제하여 해결
  - 단지 출석 진행 중인지 여부만을 확인하기 때문에 검증이 필요 없음
  
### 해결 중인 문제
1. 프론트로 넘겨주는 객체가 다 ID로 넘겨줌. 즉, 상세 내용 조회 시 한 번 더 요청해야 함 -> 비정규화
2. HTTP 폴링 대신에 SSE 적용으로 더 빠르게
3. 10분간의 출석 진행 중에 자신이 출석했는지를 확인하는 API 구성 -> 이는 폴링으로 할 시 유저를 식별해야 하므로 SSE 구현 후

## 설치 및 사용법
### 설치
1. 저장소를 클론합니다:
    ```bash
    git clone https://github.com/Pironeer-APP/Pironeer_Attend_Web.git
    ```
2. 종속성을 설치합니다:
    ```bash
    cd Pironeer_Attend_Web
    npm install
    ```

### 사용법
1. 환경에 맞게 app.js와 스웨거 파일, 환경변수 파일을 변경합니다.

2. 개발 서버를 시작합니다:
    ```bash
    node app.js
    또는
    pm2 start app
    ```

3. 브라우저에서 `http://localhost:3000/api-docs/`에 접속합니다.

## 프로젝트 구조
```plaintext
project
├──api
    ├── cache
    ├── models        # 데이터베이스 모델 정의
    ├── middleware    # 미들웨어 로직
    ├── controllers   # 요청을 처리하는 컨트롤러
    ├── routes        # 라우터 설정
├── config
├── swagger        # 스웨거 설정 파일
├── app.js
├── .env           # 환경변수 파일
└── .gitignore     

# API 개요

이 API는 출석 관리 시스템을 위한 RESTful API입니다. 사용자, 세션, 출석 정보를 관리할 수 있습니다.

## 인증 방법

이 API는 JWT(JSON Web Token) 인증 방식을 사용합니다. 모든 요청에는 헤더에 토큰을 포함해야 합니다: